<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Hyperledger国际化工作组">
  
  <title>Channel 重新配置(configtxlator) - Hyperledger中文文档</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Channel 重新配置(configtxlator)";
    var mkdocs_page_input_path = "configtxlator_zh.md";
    var mkdocs_page_url = "/configtxlator_zh/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Hyperledger中文文档</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">欢迎</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../glossary/">词汇表</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../getting_started/">快速入门</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../protocol-spec_zh/">协议规范</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Fabric教程</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../build_network_zh/">构建第一个fabric网络</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../write_first_app_zh/">编写第一个应用</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../chaincode_zh/">Chaincode</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Fabric操作指南</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../msp_zh/">MSP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configtx_zh/">Channel 配置(configtx)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configtxgen_zh/">Channel 配置(configtxgen)</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Channel 重新配置(configtxlator)</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#overview">概览（Overview）</a></li>
                
            
                <li class="toctree-l3"><a href="#configtxlator-running-the-configtxlator">运行 configtxlator 工具（Running the configtxlator）</a></li>
                
            
                <li class="toctree-l3"><a href="#proto-translation">原型翻译（Proto translation）</a></li>
                
            
                <li class="toctree-l3"><a href="#config-update-computation">配置更新计算（Config update computation）</a></li>
                
            
                <li class="toctree-l3"><a href="#bootstraping-example">引导实例（Bootstraping example）</a></li>
                
            
                <li class="toctree-l3"><a href="#reconfiguration-example">重配置示例（Reconfiguration example）</a></li>
                
            
                <li class="toctree-l3"><a href="#adding-an-organization">增加组织（Adding an organization）</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../endorsement-policies_zh/">背书策略</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../error-handling_zh/">错误处理</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../logging-control_zh/">日志控制</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Fabric设计</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../arch-deep-dive_zh/">架构说明</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../txflow_zh/">交易流程</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ca-setup_zh/">CA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../sdk_node_zh/">SDK--node</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../sdk_java_zh/">SDK--java</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../kafka_zh/">基于kafka的排序服务</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../channels_zh/">Channels</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ledger_zh/">账本</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../read-write-set/">Read-Write set</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../gossip_zh/">Gossip数据传输协议</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../msp_acl_zh/">MSP&ACL</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../sdk-design_zh/">Fabric SDK 设计</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../makefile_zh/">Makefile文件解析</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Hyperledger中文文档</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Fabric操作指南 &raquo;</li>
        
      
    
    <li>Channel 重新配置(configtxlator)</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/ylsGit/hyperledgerDocs" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <table>
<thead>
<tr>
<th>原文</th>
<th>作者</th>
<th>审核修正</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://hyperledger-fabric.readthedocs.io/en/latest/configtxlator.html">原文</a></td>
<td>Shaoxi Qiu</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="overview">概览（Overview）<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The <code>configtxlator</code> tool was created to support reconfiguration independent
of SDKs. Channel configuration is stored as a transaction in configuration
blocks of a channel and may be manipulated directly, such as in the bdd behave
tests.  However, at the time of this writing, no SDK natively supports
manipulating the configuration directly, so the <code>configtxlator</code> tool is
designed to provide an API which consumers of any SDK may interact with to
assist with configuration updates.</p>
<p>开发 <code>configtxlator</code> 工具是为了支持独立于SDK来进行重新配置。通道配置通过一个交易的形式存储在通道的配置区块中，并且能够直接被修改，就像bdd行为测试。
然而，在本文写作的时间，还没有SDK原生支持直接修改配置，所以 <code>configtxlator</code> 工具被设计为提供一个API让任意一个SDK的用户都能够与之交互来更新配置。</p>
<p>The tool name is a portmanteau of <em>configtx</em> and <em>translator</em> and is intended to
convey that the tool simply converts between different equivalent data
representations. It does not generate configuration. It does not submit or
retrieve configuration. It does not modify configuration itself, it simply
provides some bijective operations between different views of the configtx
format.</p>
<p>工具的名称是 <em>configtx</em> 和 <em>translator</em> 的拼接，意在传达该工具简单地在不同的等效数据之间进行转换。
它不产生配置。也不提交或撤回配置。它不修改配置本身，只是简单地提供一些配置格式的不同的双射展现。</p>
<p>译者注：既是单射又是满射的函数称为双射. 函数为双射当且仅当每个可能的像有且仅有一个变量与之对应。参考：http://www.cnblogs.com/wanghetao/archive/2012/03/16/2400619.html</p>
<p>The standard usage is expected to be:</p>
<ol>
<li>SDK retrieves latest config
  2. <code>configtxlator</code> produces human readable version of config</li>
<li>User or application edits the config</li>
<li><code>configtxlator</code> is used to compute config update representation of
     changes to the config</li>
<li>SDK submits signs and submits config</li>
</ol>
<p>标准用法：</p>
<p>1. SDK 取出最新的配置
  2.  <code>configtxlator</code> 工具产生可读版本的配置文件
  3. 用户或者应用编辑配置文件
  4. 使用 <code>configtxlator</code> 工具计算更新的配置与原有配置的差异
  5. SDK 提交配置以及签名</p>
<p>The <code>configtxlator</code> tool exposes a truly stateless REST API for interacting
with configuration elements.  These REST components support converting the
native configuration format to/from a human readable JSON representation, as
well as computing configuration updates based on the difference between two
configurations.</p>
<p><code>configtxlator</code> 工具暴露一个完全无状态的 REST API 接口用来和配置匀速进行交互。 
 这些 REST 组件支持本地的配置和可读的JSON格式配置文件进行相互转换， 同时根据配置文件的差异计算配置的更新。</p>
<p>Because the <code>configtxlator</code> service deliberately does not contain any crypto
material, or otherwise secret information, it does not include any authorization
or access control. The anticipated typical deployment would be to operate as
a sandboxed container, locally with the application, so that there is a
dedicated <code>configtxlator</code> process for each consumer of it.</p>
<p>因为 <code>configtxlator</code> 工具特意没有包含任何密码工具和密钥信息， 所有它没有任何权限控制。
预计的典型部署方式是运行在沙盒容器中， 所以在本地的应用中， 有一个专用的 <code>configtxlator</code> 进程给每一个使用者。</p>
<h2 id="configtxlator-running-the-configtxlator">运行 configtxlator 工具（Running the configtxlator）<a class="headerlink" href="#configtxlator-running-the-configtxlator" title="Permanent link">&para;</a></h2>
<p>The <code>configtxlator</code> tool can be downloaded with the other Hyperledger Fabric
platform-specific binaries. Please see :ref:<code>download-platform-specific-binaries</code>
for details.</p>
<p><code>configtxlator</code> 工具可以和其他 Hyperledger Fabric 平台专用工具一样被下载使用。详情请查看 ref:<code>download-platform-specific-binaries</code> 。</p>
<p>The tool may be configured to listen on a different port and you may also
specify the hostname using the <code>--port</code> and <code>--hostname</code> flags. To explore
the complete set of commands and flags, run <code>configtxlator --help</code>.</p>
<p>该工具可以配置去监听不同的端口和地址，只用  <code>--port</code> 和 <code>--hostname</code> 参数。
查看所有参数的详细信息，执行 <code>configtxlator --help</code>.</p>
<p>The binary will start an http server listening on the designated port and is now
ready to process request.</p>
<p>工具启动一个服务器监听指定的端口且等待处理请求。</p>
<p>To start the <code>configtxlator</code> server:</p>
<p>执行命令启动 <code>configtxlator</code> 服务：</p>
<p>.. code:: bash</p>
<p>configtxlator start
  2017-06-21 18:16:58.248 HKT [configtxlator] startServer -&gt; INFO 001 Serving HTTP requests on 0.0.0.0:7059</p>
<h2 id="proto-translation">原型翻译（Proto translation）<a class="headerlink" href="#proto-translation" title="Permanent link">&para;</a></h2>
<p>For extensibility, and because certain fields must be signed over, many proto
fields are stored as bytes.  This makes the natural proto to JSON translation
using the <code>jsonpb</code> package ineffective for producing a human readable version
of the protobufs.  Instead, the <code>configtxlator</code> exposes a REST component to do
a more sophisticated translation.</p>
<p>为了可扩展性，以及特定的字段需要被签名，许多原型字段被存储为字节。使用 <code>jsonpb</code> 工具包来转换原型和可读的 JSON 格式因此变得无效。
替代的方式是， <code>configtxlator</code> 暴露一个REST 组件去做更复杂的翻译。</p>
<p>To convert a proto to its human readable JSON equivalent, simply post the binary
proto to the rest target
<code>http://$SERVER:$PORT/protolator/decode/&lt;message.Name&gt;</code>,
where <code>&lt;message.Name&gt;</code> is the fully qualified proto name of the message.</p>
<p>要转换原型到可读的 JSON 格式，只要发送二进制原型到 rest 目标
<code>http://$SERVER:$PORT/protolator/decode/&lt;message.Name&gt;</code>,
 <code>&lt;message.Name&gt;</code> 是合法原型名的全称。</p>
<p>For instance, to decode a configuration block saved as
<code>configuration_block.pb</code>, run the command:</p>
<p>例如，为了解析一个存储为 <code>configuration_block.pb</code> 的配置区块，执行命令：</p>
<p>.. code:: bash</p>
<p>curl -X POST &ndash;data-binary @configuration_block.pb http://127.0.0.1:7059/protolator/decode/common.Block</p>
<p>To convert the human readable JSON version of the proto message, simply post the
JSON version to <code>http://$SERVER:$PORT/protolator/encode/&lt;message.Name</code>, where
<code>&lt;message.Name&gt;</code> is again the fully qualified proto name of the message.</p>
<p>转换可读的JSON版本为原型数据，只要发送JSON版本到 <code>http://$SERVER:$PORT/protolator/encode/&lt;message.Name&gt;</code> ，
这里的 <code>&lt;message.Name&gt;</code> 是合法原型的全称。</p>
<p>For instance, to re-encode the block saved as <code>configuration_block.json</code>, run
the command:</p>
<p>例如，重新编码存储为 <code>configuration_block.json</code> 的配置区块，执行命令：</p>
<p>.. code:: bash</p>
<p>curl -X POST &ndash;data-binary @configuration_block.json http://127.0.0.1:7059/protolator/encode/common.Block</p>
<p>Any of the configuration related protos, including <code>common.Block</code>,
<code>common.Envelope</code>, <code>common.ConfigEnvelope</code>, <code>common.ConfigUpdateEnvelope</code>,
<code>common.Configuration</code>, and <code>common.ConfigUpdate</code> are valid targets for
these URLs.  In the future, other proto decoding types may be added, such as
for endorser transactions.</p>
<p>任何原型相关的配置，包括  <code>common.Block</code>,
<code>common.Envelope</code>, <code>common.ConfigEnvelope</code>, <code>common.ConfigUpdateEnvelope</code>,
<code>common.Configuration</code>, 和 <code>common.ConfigUpdate</code> 都是这些地址的合法的目标。
未来，其他解析类型可能会被增加，比如背书交易。</p>
<h2 id="config-update-computation">配置更新计算（Config update computation）<a class="headerlink" href="#config-update-computation" title="Permanent link">&para;</a></h2>
<p>Given two different configurations, it is possible to compute the config update
which transitions between them.  Simply POST the two <code>common.Config</code> proto
encoded configurations as <code>multipart/formdata</code>, with the original as field
<code>original</code> and the updated as field <code>updated</code>, to
<code>http://$SERVER:$PORT/configtxlator/compute/update-from-configs</code>.</p>
<p>两个不同的配置，可以计算出两个配置更新所需要的交易。
向  `http://<script type="math/tex">SERVER:</script>PORT/configtxlator/compute/update-from-configs<code>发送两个已编码的</code>common.Config<code>原型配置作为</code>multipart/formdata<code>，其中原始配置填入</code>original<code>域，更新配置填入</code>updated`` 域。</p>
<p>For example, given the original config as the file <code>original_config.pb</code> and
the updated config as the file <code>updated_config.pb</code> for the channel
<code>desiredchannel</code>:</p>
<p>例如，对于通道 <code>desiredchannel</code> 的原始配置文件 <code>original_config.pb</code> 和更新配置文件  <code>updated_config.pb</code> ：</p>
<p>.. code:: bash</p>
<p>curl -X POST -F channel=desiredchannel -F original=@original_config.pb -F updated=@updated_config.pb http://127.0.0.1:7059/configtxlator/compute/update-from-configs</p>
<h2 id="bootstraping-example">引导实例（Bootstraping example）<a class="headerlink" href="#bootstraping-example" title="Permanent link">&para;</a></h2>
<p>First start the <code>configtxlator</code>:</p>
<p>首先，启动启动 <code>configtxlator</code> 工具:</p>
<p>.. code:: bash</p>
<p>$ configtxlator start
  2017-05-31 12:57:22.499 EDT [configtxlator] main -&gt; INFO 001 Serving HTTP requests on port: 7059</p>
<p>First, produce a genesis block for the ordering system channel:</p>
<p>然后，为通道产生初始区块</p>
<p>.. code:: bash</p>
<p>$ configtxgen -outputBlock genesis_block.pb
  2017-05-31 14:15:16.634 EDT [common/configtx/tool] main -&gt; INFO 001 Loading configuration
  2017-05-31 14:15:16.646 EDT [common/configtx/tool] doOutputBlock -&gt; INFO 002 Generating genesis block
  2017-05-31 14:15:16.646 EDT [common/configtx/tool] doOutputBlock -&gt; INFO 003 Writing genesis block</p>
<p>Decode the genesis block into a human editable form:</p>
<p>解析初始区块为可编辑的形式</p>
<p>.. code:: bash</p>
<p>curl -X POST &ndash;data-binary @genesis_block.pb http://127.0.0.1:7059/protolator/decode/common.Block &gt; genesis_block.json</p>
<p>Edit the <code>genesis_block.json</code> file in your favorite JSON editor, or manipulate
it programatically.  Here we use the JSON CLI tool <code>jq</code>.  For simplicity, we
are editing the batch size for the channel, because it is a single numeric
field. However, any edits, including policy and MSP edits may be made here.</p>
<p>使用你喜欢的JSON编辑器编辑 <code>genesis_block.json</code> 文件，或使用程序编辑。 这里需要使用JSON  工具  <code>jq</code> .
为了方便，这里编辑通道的区块大小，因为这是一个数字字段。
然而，任何修改，包括策略和MSP都是可以做的。</p>
<p>First, let&rsquo;s establish an environment variable to hold the string that defines
the path to a property in the json:</p>
<p>首先，建立一个环境变量来存储变量的路径</p>
<p>.. code:: bash</p>
<p>export MAXBATCHSIZEPATH=&rdquo;.data.data[0].payload.data.config.channel_group.groups.Orderer.values.BatchSize.value.max_message_count&rdquo;</p>
<p>Next, let&rsquo;s display the value of that property:</p>
<p>然后，显示变量的值</p>
<p>.. code:: bash</p>
<p>jq &ldquo;$MAXBATCHSIZEPATH&rdquo; genesis_block.json
  10</p>
<p>Now, let&rsquo;s set the new batch size, and display the new value:</p>
<p>现在，设置新的区块大小，并且显示新值：</p>
<p>jq &ldquo;<script type="math/tex">MAXBATCHSIZEPATH = 20" genesis_block.json  > updated_genesis_block.json
  jq "</script>MAXBATCHSIZEPATH&rdquo; updated_genesis_block.json
  20</p>
<p>The genesis block is now ready to be re-encoded into the native proto form to be
used for bootstrapping:</p>
<p>初始区块现在已经可以被重新编码为可用于引导启动的原型格式：</p>
<p>.. code:: bash</p>
<p>curl -X POST &ndash;data-binary @updated_genesis_block.json http://127.0.0.1:7059/protolator/encode/common.Block &gt; updated_genesis_block.pb</p>
<p>The <code>updated_genesis_block.pb</code> file may now be used as the genesis block for
bootstrapping an ordering system channel.</p>
<p>现在， <code>updated_genesis_block.pb</code> 文件可以作为初始区块来引导通道启动了。</p>
<h2 id="reconfiguration-example">重配置示例（Reconfiguration example）<a class="headerlink" href="#reconfiguration-example" title="Permanent link">&para;</a></h2>
<p>In another terminal window, start the orderer using the default options,
including the provisional bootstrapper which will create a <code>testchainid</code>
ordering system channel.</p>
<p>打开另一个终端窗口，使用默认选项启动orderer，
包括临时的引导程序，将会创建一个名称为 <code>testchainid</code> 的排序通道。</p>
<p>.. code:: bash</p>
<p>ORDERER_GENERAL_LOGLEVEL=debug orderer</p>
<p>Reconfiguring a channel can be performed in a very similar way to modifying a
genesis config.</p>
<p>重配置一个通道与修改初始配置类似。</p>
<p>First, fetch the config_block proto:</p>
<p>首先，获取配置区块原型：</p>
<p>.. code:: bash</p>
<p>$ peer channel fetch config config_block.pb -o 127.0.0.1:7050 -c testchainid
  2017-05-31 15:11:37.617 EDT [msp] getMspConfig -&gt; INFO 001 intermediate certs folder not found at [/home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/intermediatecerts]. Skipping.: [stat /home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/intermediatecerts: no such file or directory]
  2017-05-31 15:11:37.617 EDT [msp] getMspConfig -&gt; INFO 002 crls folder not found at [/home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/intermediatecerts]. Skipping.: [stat /home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/crls: no such file or directory]
  Received block:  1
  Received block:  1
  2017-05-31 15:11:37.635 EDT [main] main -&gt; INFO 003 Exiting.....</p>
<p>Next, send the config block to the <code>configtxlator</code> service for decoding:</p>
<p>然后，发送配置区块到 <code>configtxlator</code> 服务进行解析：</p>
<p>.. code:: bash</p>
<p>curl -X POST &ndash;data-binary @config_block.pb http://127.0.0.1:7059/protolator/decode/common.Block &gt; config_block.json</p>
<p>Extract the config section from the block:</p>
<p>从区块中提取配置区域</p>
<p>.. code:: bash</p>
<p>jq .data.data[0].payload.data.config config_block.json &gt; config.json</p>
<p>Edit the config, saving it as a new <code>updated_config.json</code>.  Here, we set the
batch size to 30.</p>
<p>编辑配置，将编辑后的内容存放在 <code>updated_config.json</code> 。这里我们设计区块大小为30.</p>
<p>.. code:: bash</p>
<p>jq &ldquo;.channel_group.groups.Orderer.values.BatchSize.value.max_message_count = 30&rdquo; config.json  &gt; updated_config.json</p>
<p>Re-encode both the original config, and the updated config into proto:</p>
<p>重新将原配置与新配置进行编码：</p>
<p>.. code:: bash</p>
<p>curl -X POST &ndash;data-binary @config.json http://127.0.0.1:7059/protolator/encode/common.Config &gt; config.pb</p>
<p>.. code:: bash</p>
<p>curl -X POST &ndash;data-binary @updated_config.json http://127.0.0.1:7059/protolator/encode/common.Config &gt; updated_config.pb</p>
<p>Now, with both configs properly encoded, send them to the <code>configtxlator</code>
service to compute the config update which transitions between the two.</p>
<p>现在，将编码后的文件发送到 <code>configtxlator</code> 服务进行计算比对两个的差异。</p>
<p>.. code:: bash</p>
<p>curl -X POST -F original=@config.pb -F updated=@updated_config.pb http://127.0.0.1:7059/configtxlator/compute/update-from-configs -F channel=testchainid &gt; config_update.pb</p>
<p>At this point, the computed config update is now prepared. Traditionally,
an SDK would be used to sign and wrap this message. However, in the interest of
using only the peer cli, the <code>configtxlator</code> can also be used for this task.</p>
<p>到此，计算出的配置更新已经准备好了。一般，SDK会对该消息进行签名打包。
然而，为了那些只使用节点命令（peer cli）的情况， <code>configtxlator</code> 工具也能进行这个工作。</p>
<p>First, we decode the ConfigUpdate so that we may work with it as text:</p>
<p>首先，按上文所说对配置更新进行编码：</p>
<p>.. code:: bash</p>
<p>$ curl -X POST &ndash;data-binary @config_update.pb http://127.0.0.1:7059/protolator/decode/common.ConfigUpdate &gt; config_update.json</p>
<p>Then, we wrap it in an envelope message:</p>
<p>然后，讲消息进行打包：</p>
<p>.. code:: bash</p>
<p>echo &lsquo;{&ldquo;payload&rdquo;:{&ldquo;header&rdquo;:{&ldquo;channel_header&rdquo;:{&ldquo;channel_id&rdquo;:&rdquo;testchainid&rdquo;, &ldquo;type&rdquo;:2}},&rdquo;data&rdquo;:{&ldquo;config_update&rdquo;:&rsquo;$(cat config_update.json)&rsquo;}}}&rsquo; &gt; config_update_as_envelope.json</p>
<p>Next, convert it back into the proto form of a full fledged config
transaction:</p>
<p>接着，将它转换为完整配置的交易的原型结构</p>
<p>.. code:: bash</p>
<p>curl -X POST &ndash;data-binary @config_update_as_envelope.json http://127.0.0.1:7059/protolator/encode/common.Envelope &gt; config_update_as_envelope.pb</p>
<p>Finally, submit the config update transaction to ordering to perform a config
update.</p>
<p>最后，将配置更新交易提交到排序服务。</p>
<p>.. code:: bash</p>
<p>peer channel update -f config_update_as_envelope.pb -c testchainid -o 127.0.0.1:7050</p>
<h2 id="adding-an-organization">增加组织（Adding an organization）<a class="headerlink" href="#adding-an-organization" title="Permanent link">&para;</a></h2>
<p>First start the <code>configtxlator</code>:</p>
<p>首先启动 <code>configtxlator</code> 服务：</p>
<p>.. code:: bash</p>
<p>$ configtxlator start
  2017-05-31 12:57:22.499 EDT [configtxlator] main -&gt; INFO 001 Serving HTTP requests on port: 7059</p>
<p>Start the orderer using the <code>SampleDevModeSolo</code> profile option.</p>
<p>使用 <code>SampleDevModeSolo</code> 属性配置来启动排序服务。</p>
<p>.. code:: bash</p>
<p>ORDERER_GENERAL_LOGLEVEL=debug ORDERER_GENERAL_GENESISPROFILE=SampleDevModeSolo orderer</p>
<p>The process to add an organization then follows exactly like the batch size
example. However, instead of setting the batch size, a new org is defined at
the application level. Adding an organization is slightly more involved because
we must first create a channel, then modify its membership set.</p>
<p>增加组织的国政和修改区块大小的过程类似。然而，不同于设置区块大小，一个新的组织被定义在应用层。
增加一个组织涉及更多内容因为需要先创建通道，然后修改它的成员集。</p>
<p>.. Licensed under Creative Commons Attribution 4.0 International License
   https://creativecommons.org/licenses/by/4.0/</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../endorsement-policies_zh/" class="btn btn-neutral float-right" title="背书策略">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../configtxgen_zh/" class="btn btn-neutral" title="Channel 配置(configtxgen)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Hyperledger国际化工作组(yls@chainnova.com)</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ylsGit/hyperledgerDocs" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../configtxgen_zh/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../endorsement-policies_zh/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
